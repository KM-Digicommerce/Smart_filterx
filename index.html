<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Font Awesome CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <title>Chatbot with Filters</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
       
            width: 100%;
            height: 100vh;
            font-family: Arial, sans-serif;
            background-color: transparent;
            /* overflow: hidden; */
        }

        .chatbot-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: lightskyblue;
            /* Light Sky Blue */
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .chatbot-popup {
            position: fixed;
            bottom: -500px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.3);
            transition: bottom 0.3s ease-in-out;
            padding: 20px;
            z-index: 100;
            border-radius: 10px 10px 0 0;
            display: none;
            max-height: 80vh;
            overflow-y: auto;
        }

        .chatbot-popup.active {
            bottom: 80px;
            display: block;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            /* background: red; */
            color: black;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        .filter-container {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .filter-card {
            background: #d2eafb;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .filter-card:hover {
            background: #e3f2fd;
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .filter-card h4 {
            margin: 0;
            text-align: left;
            font-size: 16px;
            color: #333;
        }

        .filter-options {
            display: none;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .checkbox-label input {
            width: 16px;
            height: 16px;
            accent-color: #007bff;
        }

        .dropdown {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .clear-btn {
            background: none;
            border: none;
            color: #d9534f;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            cursor: pointer;
            position: absolute;
            right: 20px; /* Right-end position */
            bottom: 10px; /* Adjust bottom spacing */
        }

        .clear-btn:hover {
            color: #c9302c;
        }

        .reset-icon {
            font-size: 18px;
            margin-right: 5px;
            color: #d9534f;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f4f4f4;
        }

        img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .search-input {
            width: 300px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 20px;
            margin-left: 76%;
        }

        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .pagination-btn {
            padding: 10px;
            margin: 0 5px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }

        .pagination-btn:hover {
            background-color: #007bff;
            color: white;
        }

        #pageNumber {
            font-size: 18px;
            margin: 0 10px;
        }

    </style>
</head>

<body>

    <div style="margin-bottom: 20px;">
    <h3>Products Listing</h3>

    <!-- Search Bar -->
    <input type="text" id="searchInput" placeholder="Search by Product Name or SKU" class="search-input">

  
    <table id="productTable">
        <thead>
            <tr>
                <th>Logo</th>
                <th>Product Name</th>
                <th>SKU</th>
                <th>Price</th>
                <th>Brand</th>
                <th>Category</th>
                <th>Visibility</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be appended here dynamically -->
        </tbody>
    </table>
  <!-- Pagination controls -->
    <div id="pagination" class="pagination-container">
        <button id="prevPage" class="pagination-btn">Previous</button>
        <span id="pageNumber">Page 1</span>
        <button id="nextPage" class="pagination-btn">Next</button>
    </div>

    <button class="chatbot-btn" id="chatbotButton">‚ùì</button>

    <div class="chatbot-popup" id="chatPopup">
        <button class="close-btn" id="closePopup">X</button>
        <style>
            .gradient-text {
                background: linear-gradient(to right, #3bc3f9, #a037e4);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                font-size: 20px;
                margin-top: 12px;
                font-weight: bold;
                text-align: center;
            }
        </style>

        <div class="gradient-text">Product Finder</div>
        <button id="clearFilters" class="clear-btn">
            <span class="reset-icon">‚úñ</span> Reset All
        </button>

        <div style="margin-top: 20px;" id="filter-container" class="filter-container"></div>
    </div>

    <script>

        // Tooltip code
        const chatbotBtn = document.getElementById("chatbotButton");

        chatbotBtn.addEventListener("mouseover", function () {
            const tooltip = document.createElement("div");
            tooltip.innerText = "Product Finder";
            tooltip.style.position = "absolute";
            tooltip.style.bottom = "70px";
            tooltip.style.right = "10px";
            tooltip.style.backgroundColor = "black";
            tooltip.style.color = "white";
            tooltip.style.padding = "5px 10px";
            tooltip.style.borderRadius = "5px";
            tooltip.style.fontSize = "14px";
            tooltip.style.whiteSpace = "nowrap";
            tooltip.style.zIndex = "9999";
            tooltip.id = "tooltip";

            chatbotBtn.appendChild(tooltip);
        });

        chatbotBtn.addEventListener("mouseleave", function () {
            const tooltip = document.getElementById("tooltip");
            if (tooltip) {
                tooltip.remove();
            }
        });

        // Tooltip code
        document.getElementById("chatbotButton").addEventListener("click", function () {
            document.getElementById("chatPopup").classList.toggle("active");
        });

        document.getElementById("closePopup").addEventListener("click", function () {
            document.getElementById("chatPopup").classList.remove("active");
        });

        document.addEventListener("DOMContentLoaded", function () {
            const filterContainer = document.getElementById("filter-container");
            const productsPerPage = 5; // Items per page
            let currentPage = 1;
            let allProducts = [];
            let filteredProducts = [];
            let selectedCategoryId = "";
            let selectedCategoryName = "";
            let selectedFilters = {};

            // üîπ Initial API Call when page loads
            fetchProducts();

            function fetchProducts() {
                const payload = {
                    manufacture_unit_id: "67498a6c06c8bd451ab90d0a",
                    product_category_id: selectedCategoryId,
                    industry_id: "67b80d90ba414ab9b493b595",
                    filters: 'all',
                    category_filters: selectedFilters,
                    collection_name: selectedCategoryName,
                    sort_by: "", // Default sorting field
                    sort_by_value: 1, // Default sorting (ascending)
                    is_parent: false, // Default value
                    price_from: '',
                    price_to: '',
                    brand_id_list: []
                };

                fetch("https://b2bop-backend.onrender.com/app/obtainProductsList/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                })
                    .then(response => response.json())
                    .then(data => {
                        allProducts = data.data;
                        filteredProducts = data.data;  // Initially, all products are shown
                        bindProductTable(filteredProducts);
                        updatePagination();
                    })
                    .catch(error => {
                        console.error('Error fetching products:', error);
                    });
            }
            function bindProductTable(products) {
                const tableBody = document.querySelector("#productTable tbody");
                tableBody.innerHTML = ""; // Clear old data

                const start = (currentPage - 1) * productsPerPage;
                const end = start + productsPerPage;
                const pageProducts = products.slice(start, end);

                pageProducts.forEach(product => {
                    let row = document.createElement("tr");
                    row.innerHTML = `
                        <td><img src="${product.logo}" alt="Logo"></td>
                        <td>${product.product_name }</td>
                        <td>${product.sku_number_product_code_item_number}</td>
                        <td>${product.price}</td>
                        <td>${product.brand_name}</td>
                        <td>${product.end_level_category}</td>
                        <td>
                            <span class="eye-icon">
                                ${product.visible ? 
                                    '<i class="fas fa-eye"></i>' : 
                                    '<i class="fas fa-eye-slash"></i>'}
                            </span>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            function updatePagination() {
                const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
                document.getElementById("pageNumber").textContent = `Page ${currentPage} of ${totalPages}`;

                document.getElementById("prevPage").disabled = currentPage === 1;
                document.getElementById("nextPage").disabled = currentPage === totalPages;
                
            }

            // Search functionality
            document.getElementById("searchInput").addEventListener("input", function () {
                const searchQuery = this.value.toLowerCase();
                filteredProducts = allProducts.filter(product =>
                    product.product_name.toLowerCase().includes(searchQuery) ||
                    product.sku_number_product_code_item_number.toLowerCase().includes(searchQuery)
                );
                currentPage = 1; // Reset to first page on search
                bindProductTable(filteredProducts);
                updatePagination();
            });

            // Previous page button click
            document.getElementById("prevPage").addEventListener("click", function () {
                if (currentPage > 1) {
                    currentPage--;
                    bindProductTable(filteredProducts);
                    updatePagination();
                }
            });
            // Next page button click
            document.getElementById("nextPage").addEventListener("click", function () {
                const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    bindProductTable(filteredProducts);
                    updatePagination();
                }
            });

     

        // Fetch products on page load
        // fetchProducts();
    // üîπ Category Dropdown Setup
    const categoryUrl = "https://plugin-be-project.onrender.com/api/v1/categories/level/4?client_id_str=67a5e706ab8cdb82769ac09f";
    
    fetch(categoryUrl)
        .then(response => response.json())
        .then(data => {
            const categoryDropdown = document.createElement("select");
            categoryDropdown.classList.add("dropdown");
            categoryDropdown.id = "category-dropdown";

            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.textContent = "-- Select Category --";
            categoryDropdown.appendChild(defaultOption);

            data.data.categories.forEach(category => {
                let option = document.createElement("option");
                option.value = category.id;
                option.textContent = category.name;
                categoryDropdown.appendChild(option);
            });

            filterContainer.appendChild(categoryDropdown);

            categoryDropdown.addEventListener("change", function () {
                selectedCategoryId = this.value;
                selectedCategoryName = this.options[this.selectedIndex].text;
                filterContainer.innerHTML = '';
                filterContainer.appendChild(categoryDropdown);

                if (selectedCategoryId) {
                    fetchFilters(selectedCategoryId);
                    fetchProducts(); // üîπ Fetch products based on selected category
                }
            });
        });

    // üîπ Fetch Filters for Selected Category
    function fetchFilters(categoryId) {
        const filterUrl = `https://plugin-be-project.onrender.com/api/v1/categories/filters/${categoryId}`;
        
        fetch(filterUrl)
            .then(response => response.json())
            .then(data => {
                selectedFilters = {}; // Reset filters
                data.data.filters.forEach(filter => {
                    const filterCard = document.createElement("div");
                    filterCard.classList.add("filter-card");

                    const filterTitle = document.createElement("h4");
                    filterTitle.textContent = filter.name;
                    filterCard.appendChild(filterTitle);

                    const filterOptions = document.createElement("div");
                    filterOptions.classList.add("filter-options");
                    filterOptions.style.display = "none";

                    filter.config.options.forEach(option => {
                        const label = document.createElement("label");
                        label.classList.add("checkbox-label");

                        const checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.value = option.trim();

                        checkbox.addEventListener("change", function () {
                            if (checkbox.checked) {
                                if (!selectedFilters[filter.name]) {
                                    selectedFilters[filter.name] = [];
                                }
                                selectedFilters[filter.name].push(option.trim());
                            } else {
                                selectedFilters[filter.name] = selectedFilters[filter.name].filter(f => f !== option.trim());
                                if (selectedFilters[filter.name].length === 0) {
                                    delete selectedFilters[filter.name];
                                }
                            }
                            fetchProducts(); // üîπ Fetch products when filters are applied
                        });

                        label.appendChild(checkbox);
                        label.appendChild(document.createTextNode(option.trim()));
                        filterOptions.appendChild(label);
                    });

                    filterCard.appendChild(filterOptions);
                    filterContainer.appendChild(filterCard);

                    filterTitle.addEventListener("click", function () {
                        filterOptions.style.display = (filterOptions.style.display === "none") ? "block" : "none";
                    });
                });
            })
            .catch(error => console.error("Error fetching filters:", error));
    }
    function sendFilters() {
                const filtersData = {
                    collection_name: selectedCategoryName,
                    filters: selectedFilters
                };
            }
    // üîπ Clear Filters
    document.getElementById("clearFilters").addEventListener("click", function () {
        selectedFilters = {};
        selectedCategoryId = "";
        selectedCategoryName = "";

        document.querySelectorAll(".filter-container input[type=checkbox]").forEach(checkbox => {
            checkbox.checked = false;
        });

        const categoryDropdown = document.getElementById("category-dropdown");
        if (categoryDropdown) {
            categoryDropdown.value = "";
        }

        filterContainer.innerHTML = '';
        filterContainer.appendChild(categoryDropdown);

        fetchProducts(); // üîπ Fetch products after clearing filters
    });
});

    </script>
    </div>
</body>

</html>
